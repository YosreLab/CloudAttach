name: Create Release Package

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create plugin package
        run: |
          # åˆ›å»ºä¸´æ—¶ç›®å½•
          mkdir -p CloudAttach

          # å¤åˆ¶æ’ä»¶éœ€è¦çš„æ–‡ä»¶
          cp Plugin.php CloudAttach/
          cp handler.php CloudAttach/
          cp Action.php CloudAttach/
          cp CosUploader.php CloudAttach/
          cp README.md CloudAttach/

          # å¤åˆ¶ lib ç›®å½•
          cp -r lib CloudAttach/

          # åˆ›å»ºå‹ç¼©åŒ…
          zip -r CloudAttach-${GITHUB_REF#refs/tags/}.zip CloudAttach

          # æ˜¾ç¤ºå‹ç¼©åŒ…å†…å®¹
          echo "å‹ç¼©åŒ…å†…å®¹ï¼š"
          unzip -l CloudAttach-${GITHUB_REF#refs/tags/}.zip

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: CloudAttach-*.zip
          body: |
            ## ğŸ“¦ å®‰è£…è¯´æ˜

            1. ä¸‹è½½ä¸‹æ–¹çš„ `CloudAttach-${{ github.ref_name }}.zip` æ–‡ä»¶
            2. è§£å‹åå°† `CloudAttach` æ–‡ä»¶å¤¹ä¸Šä¼ åˆ° Typecho çš„ `usr/plugins/` ç›®å½•
            3. åœ¨ Typecho åå°å¯ç”¨æ’ä»¶
            4. é…ç½®è…¾è®¯äº‘ COS å‚æ•°

            ## âœ¨ æœ¬ç‰ˆæœ¬æ›´æ–°å†…å®¹

            è¯¦è§ä¸‹æ–¹çš„ Release Notes

            ---

            **å®Œæ•´æ–‡æ¡£**: [README.md](https://github.com/${{ github.repository }}/blob/main/README.md)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
