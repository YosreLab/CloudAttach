# Typecho COS附件管理插件

一个功能强大的Typecho插件，支持腾讯云COS对象存储上传附件，提供精美的管理界面，与Typecho原生机制完美兼容。

## ✨ 主要特性

### 🚀 核心功能
- **COS对象存储**：支持直接上传文件到腾讯云COS
- **批量上传**：支持拖拽上传多个文件
- **实时进度**：显示文件上传进度和状态
- **智能预览**：图片类型支持实时预览

### 🎨 界面设计
- **现代化UI**：采用Material Design风格，界面简洁优雅
- **响应式布局**：完美适配桌面端和移动端
- **流畅动画**：平滑的过渡效果和交互反馈
- **主题适配**：支持深色模式和高对比度模式

### 📝 编辑器集成
- **一键插入**：快速插入图片到文章编辑器
- **链接复制**：一键复制文件链接
- **批量管理**：支持批量删除和管理附件
- **多种编辑器**：兼容Typecho各种编辑器类型

### 🔒 兼容性保证
- **无侵入式**：不修改Typecho核心文件
- **钩子机制**：使用Typecho标准钩子系统
- **数据安全**：插件禁用后数据完整保留
- **平滑切换**：启用/禁用无缝过渡

## 📦 安装说明

### 环境要求
- PHP >= 7.0
- Typecho >= 1.2.0
- 腾讯云COS账号

### 安装步骤
1. 下载插件文件到 `usr/plugins/CosAttachmentManager` 目录
2. 在Typecho后台启用插件
3. 配置腾讯云COS相关参数
4. 开始使用！

## ⚙️ 配置说明

### 基础配置
- **Secret ID**：腾讯云API密钥ID
- **Secret Key**：腾讯云API密钥Key
- **地域**：选择COS存储地域
- **存储桶**：COS存储桶名称

### 高级配置
- **CDN域名**：可选，自定义CDN加速域名
- **文件大小限制**：单个文件最大大小（MB）
- **允许类型**：允许上传的文件扩展名

## 🎯 使用方法

### 文章编辑页
1. 在文章编辑页面，点击右下角云朵图标
2. 拖拽文件到上传区域或点击选择文件
3. 上传完成后，点击插入按钮添加到编辑器
4. 使用快捷键 `Ctrl+Shift+A` 快速打开面板

### 文章展示页
- 文章底部自动展示相关附件
- 点击附件卡片可预览或下载
- 图片支持全屏预览功能

### 快捷键
- `Ctrl+Shift+A`：打开/关闭附件管理面板
- `ESC`：关闭面板或预览模态框

## 📊 文件结构

```
CosAttachmentManager/
├── Plugin.php              # 插件主文件
├── Action.php              # 动作处理文件
├── views/                  # 视图文件目录
│   ├── attachment-panel.php # 附件管理面板
│   └── post-attachments.php # 文章附件展示
├── assets/                 # 资源文件目录
│   ├── style.css           # 样式文件
│   ├── script.js           # 脚本文件
│   └── image-placeholder.png # 图片占位符
└── README.md               # 说明文档
```

## 🔧 技术特性

### 前端技术
- **纯HTML/CSS/JavaScript**：无外部依赖
- **响应式设计**：适配各种设备
- **现代化CSS**：使用Grid、Flexbox布局
- **ES6语法**：使用现代JavaScript特性

### 后端集成
- **Typecho钩子系统**：完美兼容原生功能
- **数据库优化**：独立的附件数据表
- **安全机制**：权限验证和数据过滤
- **错误处理**：完善的异常处理机制

### 性能优化
- **懒加载**：图片按需加载
- **缓存机制**：减少重复请求
- **压缩优化**：资源文件优化
- **异步处理**：提升用户体验

## 🛠️ 开发指南

### 自定义样式
可以修改 `assets/style.css` 文件来自定义界面样式：

```css
/* 修改主题色 */
.cos-panel-header {
    background: linear-gradient(135deg, #your-color, #your-color-dark);
}
```

### 扩展功能
可以通过修改 `Plugin.php` 添加新的钩子：

```php
// 添加新的钩子
Typecho_Plugin::factory('Your_Hook')->callback = array('CosAttachmentManagerPlugin', 'yourMethod');
```

### 数据库扩展
如需添加新字段，修改数据库表结构：

```php
// 在activate方法中添加
$db->query("ALTER TABLE `{$prefix}cos_attachments` ADD COLUMN `your_field` VARCHAR(255) NOT NULL DEFAULT ''");
```

## 🐛 问题排查

### 常见问题
1. **上传失败**：检查COS配置是否正确
2. **权限错误**：确保用户具有管理员权限
3. **文件大小**：检查文件大小限制设置
4. **网络错误**：检查服务器网络连接

### 日志查看
- Typecho错误日志
- 浏览器控制台日志
- 服务器错误日志

## 📝 更新日志

### v1.0.0 (2024-01-01)
- 🎉 首次发布
- ✨ 支持COS文件上传
- 🎨 精美管理界面
- 📱 响应式设计
- 🔄 完美兼容性

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境搭建
1. 克隆代码到本地
2. 配置Typecho开发环境
3. 配置腾讯云COS测试账号
4. 开始开发调试

### 代码规范
- 遵循PSR-4编码规范
- 使用驼峰命名法
- 添加必要的注释
- 保持代码简洁清晰

## 📄 许可证

MIT License

## 🙏 致谢

- 感谢Typecho开发团队
- 感谢腾讯云COS团队
- 感谢所有贡献者

---

**如果这个插件对您有帮助，请给个Star支持一下！** 🌟